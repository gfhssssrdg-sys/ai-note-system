{% extends "base.html" %}

{% block title %}ä¸Šä¼ å†…å®¹ - AI Note System{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ“¥ ä¸Šä¼ å†…å®¹</h1>
    <p>æ·»åŠ ç½‘é¡µé“¾æ¥æˆ–ä¸Šä¼ æ–‡ä»¶åˆ°çŸ¥è¯†åº“</p>
</div>

<div class="upload-container">
    <!-- ç½‘é¡µé“¾æ¥ä¸Šä¼  -->
    <div class="upload-section">
        <h2>ğŸ”— ç½‘é¡µé“¾æ¥</h2>
        <form id="url-form" class="upload-form">
            <div class="form-group">
                <input type="url" name="url" placeholder="https://example.com/article" required>
                <button type="submit" class="btn btn-primary">æŠ“å–ç½‘é¡µ</button>
            </div>
        </form>
        <div id="url-result" class="result-area"></div>
    </div>
    
    <!-- æ–‡ä»¶ä¸Šä¼  -->
    <div class="upload-section">
        <h2>ğŸ“„ ä¸Šä¼ æ–‡ä»¶</h2>
        <form id="file-form" class="upload-form" enctype="multipart/form-data">
            <div class="form-group file-input-wrapper">
                <input type="file" name="file" id="file-input" accept=".pdf,.md,.markdown,.png,.jpg,.jpeg,.gif,.webp" required>
                <label for="file-input" class="file-label">
                    <span class="file-icon">ğŸ“</span>
                    <span class="file-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½åˆ°æ­¤å¤„</span>
                    <span class="file-hint">æ”¯æŒ PDFã€Markdownã€å›¾ç‰‡</span>
                </label>
            </div>
            <button type="submit" class="btn btn-primary">ä¸Šä¼ æ–‡ä»¶</button>
        </form>
        <div id="file-result" class="result-area"></div>
    </div>
</div>

<div class="supported-formats">
    <h3>æ”¯æŒçš„æ ¼å¼</h3>
    <div class="format-list">
        <span class="format-tag">ğŸŒ ç½‘é¡µé“¾æ¥</span>
        <span class="format-tag">ğŸ“„ PDF</span>
        <span class="format-tag">ğŸ“ Markdown</span>
        <span class="format-tag">ğŸ–¼ï¸ å›¾ç‰‡ (PNG/JPG/GIF/WebP)</span>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// ç½‘é¡µé“¾æ¥ä¸Šä¼ 
document.getElementById('url-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const resultDiv = document.getElementById('url-result');
    
    resultDiv.innerHTML = '<div class="loading">æ­£åœ¨æŠ“å–ç½‘é¡µ...</div>';
    
    try {
        const res = await fetch('/api/upload/url', {
            method: 'POST',
            body: formData
        });
        const data = await res.json();
        
        if (data.success) {
            resultDiv.innerHTML = `
                <div class="success-box">
                    <h4>âœ… ä¸Šä¼ æˆåŠŸ</h4>
                    <p><strong>${data.note.title || 'Untitled'}</strong></p>
                    <p class="preview">${data.note.content_preview}</p>
                    <a href="/note/${data.note.id}" class="btn btn-small">æŸ¥çœ‹è¯¦æƒ…</a>
                </div>
            `;
            e.target.reset();
        } else {
            resultDiv.innerHTML = `<div class="error-box">âŒ ${data.error}</div>`;
        }
    } catch (err) {
        resultDiv.innerHTML = `<div class="error-box">âŒ ä¸Šä¼ å¤±è´¥: ${err.message}</div>`;
    }
});

// æ–‡ä»¶ä¸Šä¼ 
document.getElementById('file-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const resultDiv = document.getElementById('file-result');
    
    resultDiv.innerHTML = '<div class="loading">æ­£åœ¨å¤„ç†æ–‡ä»¶...</div>';
    
    try {
        const res = await fetch('/api/upload/file', {
            method: 'POST',
            body: formData
        });
        const data = await res.json();
        
        if (data.success) {
            resultDiv.innerHTML = `
                <div class="success-box">
                    <h4>âœ… ä¸Šä¼ æˆåŠŸ</h4>
                    <p><strong>${data.note.title || 'Untitled'}</strong></p>
                    <p class="preview">${data.note.content_preview}</p>
                    <a href="/note/${data.note.id}" class="btn btn-small">æŸ¥çœ‹è¯¦æƒ…</a>
                </div>
            `;
            e.target.reset();
            document.querySelector('.file-text').textContent = 'ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½åˆ°æ­¤å¤„';
        } else {
            resultDiv.innerHTML = `<div class="error-box">âŒ ${data.error}</div>`;
        }
    } catch (err) {
        resultDiv.innerHTML = `<div class="error-box">âŒ ä¸Šä¼ å¤±è´¥: ${err.message}</div>`;
    }
});

// æ–‡ä»¶é€‰æ‹©æ˜¾ç¤ºæ–‡ä»¶å
document.getElementById('file-input').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
        document.querySelector('.file-text').textContent = file.name;
    }
});
</script>
{% endblock %}
